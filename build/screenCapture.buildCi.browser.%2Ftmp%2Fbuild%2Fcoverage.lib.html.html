<html lang="en"><head>
    <title>Code coverage report for node-npmtest-sendmail/node_modules/sendmail/sendmail.js</title>
    <meta charset="utf-8">
    <style>
        body, html {
            margin:0; padding: 0;
        }
        body {
            font-family: Arial, Helvetica;
            font-size: 10pt;
        }
        div.header, div.footer {
            background: #eee;
            padding: 1em;
        }
        div.header {
            height: 160px;
            padding: 0 1em 0 1em;
            z-index: 100;
            position: fixed;
            top: 0;
            border-bottom: 1px solid #666;
            width: 100%;
        }
        div.footer {
            border-top: 1px solid #666;
        }
        div.body {
            margin-top: 170px;
        }
        div.meta {
            font-size: 90%;
            text-align: center;
        }
        h1, h2, h3 {
            font-weight: normal;
        }
        h1 {
            font-size: 12pt;
        }
        h2 {
            font-size: 10pt;
        }
        pre {
            font-family: Menlo, Monaco, Consolas, Courier New, monospace;
            margin: 0;
            padding: 0;
            font-size: 14px;
            tab-size: 2;
        }

        div.path { font-size: 110%; }
        div.path a:link, div.path a:visited { color: #000; }
        table.coverage { border-collapse: collapse; margin:0; padding: 0 }

        table.coverage td {
            margin: 0;
            padding: 0;
            color: #111;
            vertical-align: top;
        }
        table.coverage td.line-count {
            width: 50px;
            text-align: right;
            padding-right: 5px;
        }
        table.coverage td.line-coverage {
            color: #777 !important;
            text-align: right;
            border-left: 1px solid #666;
            border-right: 1px solid #666;
        }

        table.coverage td.text {
        }

        table.coverage td span.cline-any {
            display: inline-block;
            padding: 0 5px;
            width: 40px;
        }
        table.coverage td span.cline-neutral {
            background: #eee;
        }
        table.coverage td span.cline-yes {
            background: #b5d592;
            color: #999;
        }
        table.coverage td span.cline-no {
            background: #fc8c84;
        }

        .cstat-yes { color: #111; }
        .cstat-no { background: #fc8c84; color: #111; }
        .fstat-no { background: #ffc520; color: #111 !important; }
        .cbranch-no { background:  yellow !important; color: #111; }

        .cstat-skip { background: #ddd; color: #111; }
        .fstat-skip { background: #ddd; color: #111 !important; }
        .cbranch-skip { background: #ddd !important; color: #111; }

        .missing-if-branch {
            display: inline-block;
            margin-right: 10px;
            position: relative;
            padding: 0 4px;
            background: black;
            color: yellow;
        }

        .skip-if-branch {
            display: none;
            margin-right: 10px;
            position: relative;
            padding: 0 4px;
            background: #ccc;
            color: white;
        }

        .missing-if-branch .typ, .skip-if-branch .typ {
            color: inherit !important;
        }

        .entity, .metric { font-weight: bold; }
        .metric { display: inline-block; border: 1px solid #333; padding: 0.3em; background: white; }
        .metric small { font-size: 80%; font-weight: normal; color: #666; }

        div.coverage-summary table { border-collapse: collapse; margin: 3em; font-size: 110%; }
        div.coverage-summary td, div.coverage-summary table  th { margin: 0; padding: 0.25em 1em; border-top: 1px solid #666; border-bottom: 1px solid #666; }
        div.coverage-summary th { text-align: left; border: 1px solid #666; background: #eee; font-weight: normal; }
        div.coverage-summary th.file { border-right: none !important; }
        div.coverage-summary th.pic { border-left: none !important; text-align: right; }
        div.coverage-summary th.pct { border-right: none !important; }
        div.coverage-summary th.abs { border-left: none !important; text-align: right; }
        div.coverage-summary td.pct { text-align: right; border-left: 1px solid #666; }
        div.coverage-summary td.abs { text-align: right; font-size: 90%; color: #444; border-right: 1px solid #666; }
        div.coverage-summary td.file { text-align: right; border-left: 1px solid #666; white-space: nowrap;  }
        div.coverage-summary td.pic { min-width: 120px !important;  }
        div.coverage-summary a:link { color: #000; }
        div.coverage-summary a:visited { color: #333; }
        div.coverage-summary tfoot td { border-top: 1px solid #666; }

        div.coverage-summary .yui3-datatable-sort-indicator, div.coverage-summary .dummy-sort-indicator {
            height: 10px;
            width: 7px;
            display: inline-block;
            margin-left: 0.5em;
        }
        div.coverage-summary .yui3-datatable-sort-indicator {
            background: no-repeat scroll 0 0 transparent;
        }
        div.coverage-summary .yui3-datatable-sorted .yui3-datatable-sort-indicator {
            background-position: 0 -20px;
        }
        div.coverage-summary .yui3-datatable-sorted-desc .yui3-datatable-sort-indicator {
            background-position: 0 -10px;
        }

        .high { background: #b5d592 !important; }
        .medium { background: #ffe87c !important; }
        .low { background: #fc8c84 !important; }

        span.cover-fill, span.cover-empty {
            display:inline-block;
            border:1px solid #444;
            background: white;
            height: 12px;
        }
        span.cover-fill {
            background: #ccc;
            border-right: 1px solid #444;
        }
        span.cover-empty {
            background: white;
            border-left: none;
        }
        span.cover-full {
            border-right: none !important;
        }
        pre.prettyprint {
            border: none !important;
            padding: 0 !important;
            margin: 0 !important;
        }
        .com { color: #999 !important; }
        .ignore-none { color: #999; font-weight: normal; }

    </style>
</head>
<body>
<div class="header low">
    <h1 style="font-weight: bold;">
        <a href="https://github.com/npmtest/node-npmtest-sendmail">npmtest-sendmail (v0.0.1)</a>
    </h1>
    <h1>Code coverage report for <span class="entity">node-npmtest-sendmail/node_modules/sendmail/sendmail.js</span></h1>
    <h2>
        
        Statements: <span class="metric">11.26% <small>(17 / 151)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Branches: <span class="metric">0% <small>(0 / 60)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Functions: <span class="metric">0% <small>(0 / 24)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Lines: <span class="metric">11.41% <small>(17 / 149)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        Ignored: <span class="metric"><span class="ignore-none">none</span></span> &nbsp;&nbsp;&nbsp;&nbsp;
    </h2>
    <div class="path"><a href="../../../index.html">All files</a> » <a href="index.html">node-npmtest-sendmail/node_modules/sendmail/</a> » sendmail.js</div>
</div>
<div class="body">
<pre><table class="coverage">
<tbody><tr><td class="line-count">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344</td><td class="line-coverage"><span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">var tcp = require('net')
var dns = require('dns')
var DKIMSign = require('dkim-signer').DKIMSign
var CRLF = '\r\n'
&nbsp;
<span class="fstat-no" title="function not covered">function dummy () {</span>}
module.exports = <span class="fstat-no" title="function not covered">function (options) {</span>
<span class="cstat-no" title="statement not covered">  options = options || {}</span>
<span class="cstat-no" title="statement not covered">  var logger = options.logger || (options.silent &amp;&amp; {</span>
    debug: dummy,
    info: dummy,
    warn: dummy,
    error: dummy
  } || {
    debug: console.log,
    info: console.info,
    warn: console.warn,
    error: console.error
  })
<span class="cstat-no" title="statement not covered">  var dkimPrivateKey = (options.dkim || {}).privateKey</span>
<span class="cstat-no" title="statement not covered">  var dkimKeySelector = (options.dkim || {}).keySelector || 'dkim'</span>
<span class="cstat-no" title="statement not covered">  var devPort = options.devPort || -1</span>
&nbsp;
  /*
   *   邮件服务返回代码含义 Mail service return code Meaning
   *   500   格式错误，命令不可识别（此错误也包括命令行过长）format error, command unrecognized (This error also includes command line too long)
   *   501   参数格式错误 parameter format error
   *   502   命令不可实现 command can not be achieved
   *   503   错误的命令序列 Bad sequence of commands
   *   504   命令参数不可实现 command parameter can not be achieved
   *   211   系统状态或系统帮助响应 System status, or system help response
   *   214   帮助信息 help
   *   220   服务就绪 Services Ready
   *   221   服务关闭传输信道 Service closing transmission channel
   *   421   服务未就绪，关闭传输信道（当必须关闭时，此应答可以作为对任何命令的响应）service is not ready to close the transmission channel (when it is necessary to close, this response may be in response to any command)
   *   250   要求的邮件操作完成 requested mail action completed
   *   251   用户非本地，将转发向 non-local users will be forwarded to
   *   450   要求的邮件操作未完成，邮箱不可用（例如，邮箱忙）Mail the required operation 450 unfinished, mailbox unavailable (for example, mailbox busy)
   *   550   要求的邮件操作未完成，邮箱不可用（例如，邮箱未找到，或不可访问）Mail action not completed the required 550 mailbox unavailable (eg, mailbox not found, no access)
   *   451   放弃要求的操作；处理过程中出错 waiver operation; processing error
   *   551   用户非本地，请尝试 non-local user, please try
   *   452   系统存储不足，要求的操作未执行 Less than 452 storage system, requiring action not taken
   *   552   过量的存储分配，要求的操作未执行 excess storage allocation requires action not taken
   *   553   邮箱名不可用，要求的操作未执行（例如邮箱格式错误） mailbox name is not available, that the requested operation is not performed (for example, mailbox format error)
   *   354   开始邮件输入，以.结束 Start Mail input to. End
   *   554   操作失败  The operation failed
   *   535   用户验证失败 User authentication failed
   *   235   用户验证成功 user authentication is successful
   *   334   等待用户输入验证信息 waits for the user to enter authentication information
   */
&nbsp;
<span class="fstat-no" title="function not covered">  function getHost (email) {</span>
<span class="cstat-no" title="statement not covered">    var m = /[^@]+@([\w\d\-\.]+)/.exec(email)</span>
<span class="cstat-no" title="statement not covered">    return m &amp;&amp; m[1]</span>
  }
&nbsp;
<span class="fstat-no" title="function not covered">  function groupRecipients (recipients) {</span>
<span class="cstat-no" title="statement not covered">    var groups = {}</span>
<span class="cstat-no" title="statement not covered">    var host</span>
<span class="cstat-no" title="statement not covered">    var i = 0</span>
<span class="cstat-no" title="statement not covered">    for (; i &lt; recipients.length; i++) {</span>
<span class="cstat-no" title="statement not covered">      host = getHost(recipients[i]);</span>
<span class="cstat-no" title="statement not covered">      (groups[host] || (groups[host] = [])).push(recipients[i])</span>
    }
<span class="cstat-no" title="statement not covered">    return groups</span>
  }
&nbsp;
  /**
   * connect to domain by Mx record
   */
<span class="fstat-no" title="function not covered">  function connectMx (domain, callback) {</span>
<span class="cstat-no" title="statement not covered">    if (devPort === -1) { // not in development mode -&gt; search the MX</span>
<span class="cstat-no" title="statement not covered">      dns.resolveMx(domain, <span class="fstat-no" title="function not covered">function (err, data) {</span></span>
<span class="cstat-no" title="statement not covered">        if (err) {</span>
<span class="cstat-no" title="statement not covered">          return callback(err)</span>
        }
&nbsp;
<span class="cstat-no" title="statement not covered">        data.sort(<span class="fstat-no" title="function not covered">function (a, b) {</span> <span class="cstat-no" title="statement not covered">return a.priority &lt; b.priority }</span>)</span>
<span class="cstat-no" title="statement not covered">        logger.debug('mx resolved: ', data)</span>
&nbsp;
<span class="cstat-no" title="statement not covered">        if (!data || data.length === 0) {</span>
<span class="cstat-no" title="statement not covered">          return callback(new Error('can not resolve Mx of &lt;' + domain + '&gt;'))</span>
        }
&nbsp;
<span class="fstat-no" title="function not covered">        function tryConnect (i) {</span>
<span class="cstat-no" title="statement not covered">          if (i &gt;= data.length) <span class="cstat-no" title="statement not covered">return callback(new Error('can not connect to any SMTP server'))</span></span>
&nbsp;
<span class="cstat-no" title="statement not covered">          var sock = tcp.createConnection(25, data[i].exchange)</span>
&nbsp;
<span class="cstat-no" title="statement not covered">          sock.on('error', <span class="fstat-no" title="function not covered">function (err) {</span></span>
<span class="cstat-no" title="statement not covered">            logger.error('Error on connectMx for: ', data[i], err)</span>
<span class="cstat-no" title="statement not covered">            tryConnect(++i)</span>
          })
&nbsp;
<span class="cstat-no" title="statement not covered">          sock.on('connect', <span class="fstat-no" title="function not covered">function () {</span></span>
<span class="cstat-no" title="statement not covered">            logger.debug('MX connection created: ', data[i].exchange)</span>
<span class="cstat-no" title="statement not covered">            sock.removeAllListeners('error')</span>
<span class="cstat-no" title="statement not covered">            callback(null, sock)</span>
          })
        };
&nbsp;
<span class="cstat-no" title="statement not covered">        tryConnect(0)</span>
      })
    } else { // development mode -&gt; connect to the specified devPort on localhost
<span class="cstat-no" title="statement not covered">      var sock = tcp.createConnection(devPort)</span>
&nbsp;
<span class="cstat-no" title="statement not covered">      sock.on('error', <span class="fstat-no" title="function not covered">function (err) {</span></span>
<span class="cstat-no" title="statement not covered">        callback(new Error('Error on connectMx (development) for "localhost:' + devPort + '": ' + err))</span>
      })
&nbsp;
<span class="cstat-no" title="statement not covered">      sock.on('connect', <span class="fstat-no" title="function not covered">function () {</span></span>
<span class="cstat-no" title="statement not covered">        logger.debug('MX (development) connection created: localhost:' + devPort)</span>
<span class="cstat-no" title="statement not covered">        sock.removeAllListeners('error')</span>
<span class="cstat-no" title="statement not covered">        callback(null, sock)</span>
      })
    }
  }
&nbsp;
<span class="fstat-no" title="function not covered">  function sendToSMTP (domain, srcHost, from, recipients, body, cb) {</span>
<span class="cstat-no" title="statement not covered">    var callback = (typeof cb === 'function') ? cb : <span class="fstat-no" title="function not covered">function () {</span>}</span>
<span class="cstat-no" title="statement not covered">    connectMx(domain, <span class="fstat-no" title="function not covered">function (err, sock) {</span></span>
<span class="cstat-no" title="statement not covered">      if (err) {</span>
<span class="cstat-no" title="statement not covered">        logger.error('error on connectMx', err.stack)</span>
<span class="cstat-no" title="statement not covered">        return callback(err)</span>
      }
&nbsp;
<span class="fstat-no" title="function not covered">      function w (s) {</span>
<span class="cstat-no" title="statement not covered">        logger.debug('send ' + domain + '&gt;' + s)</span>
<span class="cstat-no" title="statement not covered">        sock.write(s + CRLF)</span>
      }
&nbsp;
<span class="cstat-no" title="statement not covered">      sock.setEncoding('utf8')</span>
&nbsp;
<span class="cstat-no" title="statement not covered">      sock.on('data', <span class="fstat-no" title="function not covered">function (chunk) {</span></span>
<span class="cstat-no" title="statement not covered">        data += chunk</span>
<span class="cstat-no" title="statement not covered">        parts = data.split(CRLF)</span>
<span class="cstat-no" title="statement not covered">        for (var i = 0, len = parts.length - 1; i &lt; len; i++) {</span>
<span class="cstat-no" title="statement not covered">          onLine(parts[i])</span>
        }
<span class="cstat-no" title="statement not covered">        data = parts[parts.length - 1]</span>
      })
&nbsp;
<span class="cstat-no" title="statement not covered">      sock.on('error', <span class="fstat-no" title="function not covered">function (err) {</span></span>
<span class="cstat-no" title="statement not covered">        logger.error('fail to connect ' + domain)</span>
<span class="cstat-no" title="statement not covered">        callback(err)</span>
      })
&nbsp;
<span class="cstat-no" title="statement not covered">      var data = ''</span>
<span class="cstat-no" title="statement not covered">      var step = 0</span>
<span class="cstat-no" title="statement not covered">      var loginStep = 0</span>
<span class="cstat-no" title="statement not covered">      var queue = []</span>
<span class="cstat-no" title="statement not covered">      var login = []</span>
<span class="cstat-no" title="statement not covered">      var parts</span>
<span class="cstat-no" title="statement not covered">      var cmd</span>
&nbsp;
        /*
         if(mail.user &amp;&amp; mail.pass){
           queue.push('AUTH LOGIN');
           login.push(new Buffer(mail.user).toString("base64"));
           login.push(new Buffer(mail.pass).toString("base64"));
         }
         */
&nbsp;
<span class="cstat-no" title="statement not covered">      queue.push('MAIL FROM:&lt;' + from + '&gt;')</span>
<span class="cstat-no" title="statement not covered">      for (var i = 0; i &lt; recipients.length; i++) {</span>
<span class="cstat-no" title="statement not covered">        queue.push('RCPT TO:&lt;' + recipients[i] + '&gt;')</span>
      }
<span class="cstat-no" title="statement not covered">      queue.push('DATA')</span>
<span class="cstat-no" title="statement not covered">      queue.push('QUIT')</span>
<span class="cstat-no" title="statement not covered">      queue.push('')</span>
&nbsp;
<span class="fstat-no" title="function not covered">      function response (code, msg) {</span>
<span class="cstat-no" title="statement not covered">        switch (code) {</span>
          case 220:
            //*   220   on server ready
            //*   220   服务就绪
<span class="cstat-no" title="statement not covered">            if (/\besmtp\b/i.test(msg)) {</span>
              // TODO:  determin AUTH type; auth login, auth crm-md5, auth plain
<span class="cstat-no" title="statement not covered">              cmd = 'EHLO'</span>
            } else {
<span class="cstat-no" title="statement not covered">              cmd = 'HELO'</span>
            }
<span class="cstat-no" title="statement not covered">            w(cmd + ' ' + srcHost)</span>
<span class="cstat-no" title="statement not covered">            break</span>
&nbsp;
          case 221: // bye
          case 235: // verify ok
          case 250: // operation OK
          case 251: // foward
<span class="cstat-no" title="statement not covered">            if (step === queue.length - 1) {</span>
<span class="cstat-no" title="statement not covered">              logger.info('OK:', code, msg)</span>
<span class="cstat-no" title="statement not covered">              callback(null, msg)</span>
            }
<span class="cstat-no" title="statement not covered">            w(queue[step])</span>
<span class="cstat-no" title="statement not covered">            step++</span>
<span class="cstat-no" title="statement not covered">            break</span>
&nbsp;
          case 354: // start input end with . (dot)
<span class="cstat-no" title="statement not covered">            logger.info('sending mail', body)</span>
<span class="cstat-no" title="statement not covered">            w(body)</span>
<span class="cstat-no" title="statement not covered">            w('')</span>
<span class="cstat-no" title="statement not covered">            w('.')</span>
<span class="cstat-no" title="statement not covered">            break</span>
&nbsp;
          case 334: // input login
<span class="cstat-no" title="statement not covered">            w(login[loginStep])</span>
<span class="cstat-no" title="statement not covered">            loginStep++</span>
<span class="cstat-no" title="statement not covered">            break</span>
&nbsp;
          default:
<span class="cstat-no" title="statement not covered">            if (code &gt;= 400) {</span>
<span class="cstat-no" title="statement not covered">              logger.warn('SMTP responds error code', code)</span>
<span class="cstat-no" title="statement not covered">              callback(new Error('SMTP code:' + code + ' msg:' + msg))</span>
<span class="cstat-no" title="statement not covered">              sock.end()</span>
            }
        }
      }
&nbsp;
<span class="cstat-no" title="statement not covered">      var msg = ''</span>
&nbsp;
<span class="fstat-no" title="function not covered">      function onLine (line) {</span>
<span class="cstat-no" title="statement not covered">        logger.debug('recv ' + domain + '&gt;' + line)</span>
&nbsp;
<span class="cstat-no" title="statement not covered">        msg += (line + CRLF)</span>
&nbsp;
<span class="cstat-no" title="statement not covered">        if (line[3] === ' ') {</span>
            // 250-information dash is not complete.
            // 250 OK. space is complete.
<span class="cstat-no" title="statement not covered">          response(parseInt(line), msg)</span>
<span class="cstat-no" title="statement not covered">          msg = ''</span>
        }
      }
    })
  }
&nbsp;
<span class="fstat-no" title="function not covered">  function getAddress (address) {</span>
<span class="cstat-no" title="statement not covered">    return address.replace(/^.+&lt;/, '').replace(/&gt;\s*$/, '').trim()</span>
  }
&nbsp;
<span class="fstat-no" title="function not covered">  function getAddresses (addresses) {</span>
<span class="cstat-no" title="statement not covered">    var i</span>
<span class="cstat-no" title="statement not covered">    var results = []</span>
<span class="cstat-no" title="statement not covered">    if (!Array.isArray(addresses)) {</span>
<span class="cstat-no" title="statement not covered">      addresses = addresses.split(',')</span>
    }
<span class="cstat-no" title="statement not covered">    for (i = 0; i &lt; addresses.length; i++) {</span>
<span class="cstat-no" title="statement not covered">      results.push(getAddress(addresses[i]))</span>
    }
<span class="cstat-no" title="statement not covered">    return results</span>
  }
&nbsp;
  /**
   * sendmail directly
   *
   * @param mail {object}
   *             from
   *             to
   *             cc
   *             bcc
   *             replyTo      TODO
   *             returnTo     TODO
   *             subject
   *             type         default 'text/plain', 'text/html'
   *             charset      default 'utf-8'
   *             encoding     default 'base64'
   *             id           default timestamp+from
   *             headers      object
   *             content
   *             attachments  TODO
   *               [{
   *                 type
   *                 filename
   *                 content
   *               }].
   *
   * @param callback function(err, domain).
   *
   */
<span class="fstat-no" title="function not covered">  function sendmail (mail, callback) {</span>
<span class="cstat-no" title="statement not covered">    var recipients = []</span>
<span class="cstat-no" title="statement not covered">    var groups</span>
<span class="cstat-no" title="statement not covered">    var srcHost</span>
<span class="cstat-no" title="statement not covered">    if (mail.to) {</span>
<span class="cstat-no" title="statement not covered">      recipients = recipients.concat(getAddresses(mail.to))</span>
    }
&nbsp;
<span class="cstat-no" title="statement not covered">    if (mail.cc) {</span>
<span class="cstat-no" title="statement not covered">      recipients = recipients.concat(getAddresses(mail.cc))</span>
    }
&nbsp;
<span class="cstat-no" title="statement not covered">    if (mail.bcc) {</span>
<span class="cstat-no" title="statement not covered">      recipients = recipients.concat(getAddresses(mail.bcc))</span>
    }
&nbsp;
<span class="cstat-no" title="statement not covered">    groups = groupRecipients(recipients)</span>
&nbsp;
<span class="cstat-no" title="statement not covered">    var from = getAddress(mail.from)</span>
<span class="cstat-no" title="statement not covered">    srcHost = getHost(from)</span>
<span class="cstat-no" title="statement not covered">    var mailcomposer = require('mailcomposer')</span>
<span class="cstat-no" title="statement not covered">    var mailMe = mailcomposer(mail)</span>
<span class="cstat-no" title="statement not covered">    mailMe.build(<span class="fstat-no" title="function not covered">function (err, message) {</span></span>
<span class="cstat-no" title="statement not covered">      if (err) {</span>
<span class="cstat-no" title="statement not covered">        logger.error('Error on creating message : ', err)</span>
<span class="cstat-no" title="statement not covered">        callback(err, null)</span>
<span class="cstat-no" title="statement not covered">        return</span>
      }
<span class="cstat-no" title="statement not covered">      if (dkimPrivateKey) {</span>
<span class="cstat-no" title="statement not covered">        var signature = DKIMSign(message, {</span>
          privateKey: dkimPrivateKey,
          keySelector: dkimKeySelector,
          domainName: srcHost
        })
<span class="cstat-no" title="statement not covered">        message = signature + '\r\n' + message</span>
      }
<span class="cstat-no" title="statement not covered">      for (var domain in groups) {</span>
<span class="cstat-no" title="statement not covered">        sendToSMTP(domain, srcHost, from, groups[domain], message, callback)</span>
      }
    })
    // COMMENTED OUT BY GP BECAUSE I SAW NO USE FOR IT
    // var domainsCount = Object.keys(groups).length
    // var doneCount
    // var errs = []
    // function domainDone(domain) {
    //   return function(err) {
    //     if (err) {
    //       errs.push(err)
    //     }
    //     if(doneCount == domainsCount) {
    //       if (errs.length == 0) {
    //         err = null
    //       } else if(errs.length == 1) {
    //         err = errs[0]
    //       } else {
    //         err = new Error(errs.map(function(e) {return e.message}).join('\n'))
    //       }
    //       callback(message &amp;&amp; new Error(message) || null)
    //     }
    //   }
    // }
  }
<span class="cstat-no" title="statement not covered">  return sendmail</span>
}
&nbsp;
&nbsp;</pre></td></tr>
</tbody></table></pre>
</div>
<div class="footer">
    <div class="meta">Generated by <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a> at Wed Apr 26 2017 06:09:10 GMT+0000 (UTC)</div>
</div>


</body></html>